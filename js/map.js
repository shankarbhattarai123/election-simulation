        //  POKEMON-STYLE TOP-DOWN WORLD — 22x18 MAP
        // ═══════════════════════════════════════════════════════

        var TS = 32; // tile size in pixels
        var canvas, ctx, W, H;
        var camX = 0, camY = 0;

        // ── MAP KEY ──
        // 0=grass light, 1=grass dark, 2=path/sand, 3=pavement,
        // 4=water, 5=indoor floor, 6=tall grass, 7=flowers,
        // 9=tree(blocked), W=wall(blocked)
        // 22 cols × 18 rows
        const TILEMAP = [
            [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9], // 0
            [9, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 9, 9, 9], // 1
            [9, 1, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 1, 9, 9, 9], // 2
            [9, 1, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 1, 9, 9, 9], // 3
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 4 top of building
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 5 ink row
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 6
            [9, 1, 0, 7, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 7, 0, 0, 1, 9, 9, 9], // 7 booth row
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 8 box row
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 9
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 10
            [9, 1, 0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 1, 9, 9, 9], // 11 ID desk row
            [9, 1, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 1, 9, 9, 9], // 12 entrance corridor
            [9, 1, 0, 9, 0, 0, 0, 0, 2, 2, 2, 0, 0, 9, 0, 0, 0, 0, 1, 9, 9, 9], // 13
            [9, 1, 0, 0, 0, 7, 0, 0, 2, 2, 2, 0, 7, 0, 0, 0, 0, 0, 1, 9, 9, 9], // 14
            [9, 1, 1, 1, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 1, 1, 9, 9, 9, 9, 9, 9], // 15
            [9, 9, 4, 4, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 4, 4, 9, 9, 9, 9, 9, 9], // 16 start row (water sides)
            [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9], // 17
        ];

        // Walkable: 0=can walk, 1=blocked
        const WALK = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        ];
        const ROWS = WALK.length, COLS = WALK[0].length;

        // ── TILE PALETTES ──
        const TILE_COLORS = {
            0: ['#78c850', '#68b840'],
            1: ['#50a030', '#408820'],
            2: ['#d8b868', '#c8a858'],
            3: ['#c8c0a8', '#b8b098'],
            4: ['#48a8e8', '#3898d8'],
            5: ['#d8cca8', '#c8bc98'],  // warm indoor floor
            6: ['#58a838', '#489028'],
            7: ['#78c850', '#68b840'],
            9: ['#285018', '#1e3e12'],
        };

        // ── BUILDING FOOTPRINT (tiles that are "inside") ──
        function isInsideBooth() {
            return G.py >= 4 && G.py <= 11 && G.px >= 4 && G.px <= 14;
        }

        const ZONES = [
            { tx: 9, ty: 12, phase: 'queue', event: 'id', label: 'परिचय डेस्क', color: '#f0a020' },
            { tx: 9, ty: 7, phase: 'post-id', event: 'ballot', label: 'मत बुथ', color: '#4080e0' },
            { tx: 12, ty: 8, phase: 'post-ballot', event: 'box', label: 'मतपेटिका', color: '#40a060' },
            { tx: 6, ty: 5, phase: 'post-box', event: 'ink', label: 'मसी केन्द्र', color: '#9040d0' },
        ];

        const NPCS = [
            { tx: 3, ty: 4, color: '#e040a0', hat: '#8020c0', walkR: 1.2, dir: 0, phase: 0 },
            { tx: 12, ty: 5, color: '#40a0e0', hat: '#206080', walkR: 0.8, dir: 2, phase: 1 },
            { tx: 4, ty: 12, color: '#e08040', hat: '#804020', walkR: 1.5, dir: 1, phase: 2 },
            { tx: 11, ty: 13, color: '#60c060', hat: '#306030', walkR: 0, dir: 3, phase: 0 },
            { tx: 7, ty: 3, color: '#c0c040', hat: '#606020', walkR: 0, dir: 0, phase: 1 },
            { tx: 6, ty: 11, color: '#d04040', hat: '#801818', walkR: 0.6, dir: 2, phase: 3 },
        ];
